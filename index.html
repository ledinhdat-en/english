<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>English Phrasal Verbs Quiz</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2em auto; }
  .answer { margin: 8px 0; padding: 8px; border: 1px solid #ccc; cursor: pointer; }
  .answer.correct { background-color: #a8e6a3; }
  .answer.wrong { display: none; }
</style>
</head>
<body>

<h2>Chọn nghĩa đúng của câu sau:</h2>
<div id="question"></div>
<div id="answers"></div>

<script>
const url = "https://script.google.com/macros/s/AKfycbxAm9SvhJn5SEPYxGSysEuarr-liSh8EbiR79DR86LWWtVCh0pa7B7BMQlbCaY8WChUNA/exec";

let data = [];
let currentIndex = 0;

async function fetchData() {
  const res = await fetch(url);
  data = await res.json();
  nextQuestion();
}

function shuffle(array) {
  for (let i = array.length -1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function nextQuestion() {
  if (currentIndex >= data.length) {
    alert("Bạn đã làm xong bài quiz!");
    currentIndex = 0;
  }

  const item = data[currentIndex];
  currentIndex++;

  // Hiển thị câu ví dụ (loại 3)
  document.getElementById("question").textContent = item.example;

  // Tạo 4 đáp án (nghĩa) gồm 1 đúng + 3 ngẫu nhiên
  let answers = [item.meaning];

  // Lấy 3 nghĩa ngẫu nhiên khác
  let others = data.filter(d => d.meaning !== item.meaning);
  shuffle(others);
  others = others.slice(0, 3);
  others.forEach(d => answers.push(d.meaning));

  shuffle(answers);

  const answersDiv = document.getElementById("answers");
  answersDiv.innerHTML = "";

  answers.forEach(ans => {
    const div = document.createElement("div");
    div.textContent = ans;
    div.className = "answer";
    div.onclick = () => {
      if (ans === item.meaning) {
        div.classList.add("correct");
        setTimeout(nextQuestion, 1000);
      } else {
        div.classList.add("wrong");
        div.style.display = "none";
      }
    };
    answersDiv.appendChild(div);
  });
}

fetchData();
</script>

</body>
</html>
